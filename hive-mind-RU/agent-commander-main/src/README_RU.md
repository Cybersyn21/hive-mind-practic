# Каталог src/ — Исходный код

## Описание

Каталог `src/` содержит исходный код библиотеки agent-commander. Код написан на JavaScript (ESM модули) и совместим с Node.js, Bun и Deno.

## Файлы

### index.mjs
**Назначение**: Главная точка входа библиотеки.

**Экспорты**:
- `agent(options)` — Создание контроллера агента

**Пример использования**:
```javascript
import { agent } from 'agent-commander';

const myAgent = agent({
  tool: 'claude',
  workingDirectory: '/tmp/project',
  prompt: 'Выполни задачу'
});

await myAgent.start();
const result = await myAgent.stop();
```

### command-builder.mjs
**Назначение**: Построение командных строк для запуска агентов.

**Функциональность**:
- Формирование команд для разных инструментов (claude, opencode, codex)
- Добавление опций и флагов
- Экранирование аргументов
- Обёртки для изоляции (screen, docker)

**Пример**:
```javascript
import { buildCommand } from './command-builder.mjs';

const cmd = buildCommand({
  tool: 'claude',
  workingDirectory: '/tmp/dir',
  prompt: 'Привет',
  isolation: 'screen',
  screenName: 'my-session'
});

// Результат: screen -S my-session -dm claude --print --dangerously-skip-permissions ...
```

### executor.mjs
**Назначение**: Выполнение построенных команд.

**Функциональность**:
- Запуск процессов
- Управление stdin/stdout/stderr
- Обработка сигналов (SIGINT, SIGTERM)
- Сбор вывода
- Определение кода выхода

**Типы выполнения**:
- Прямое выполнение (без изоляции)
- Через screen
- Через docker

### cli-parser.mjs
**Назначение**: Парсинг аргументов командной строки.

**Поддерживаемые опции**:

| Опция | Описание |
|-------|----------|
| `--tool` | Инструмент (claude, opencode, codex) |
| `--working-directory` | Рабочая директория |
| `--prompt` | Промпт для агента |
| `--system-prompt` | Системный промпт |
| `--isolation` | Режим изоляции (none, screen, docker) |
| `--screen-name` | Имя screen сессии |
| `--container-name` | Имя docker контейнера |
| `--detached` | Фоновый режим |
| `--dry-run` | Только показать команду |

## Каталог utils/

### loader.mjs
**Назначение**: Динамическая загрузка модулей.

**Функциональность**:
- Интеграция с [use-m](https://github.com/nicholasgold/use-m) — загрузка модулей из CDN
- Lazy loading зависимостей
- Кеширование модулей

**Пример**:
```javascript
import { load } from './utils/loader.mjs';

const commandStream = await load('command-stream');
```

## Архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                    Пользователь                              │
│            (start-agent или JavaScript API)                 │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      cli-parser.mjs                          │
│              (Парсинг опций командной строки)               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     index.mjs (agent)                        │
│              (Создание контроллера агента)                  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                   command-builder.mjs                        │
│             (Построение командной строки)                   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      executor.mjs                            │
│               (Выполнение команды)                          │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ▼                     ▼                     ▼
┌───────────────┐     ┌───────────────┐     ┌───────────────┐
│    Прямой     │     │    Screen     │     │    Docker     │
│    процесс    │     │    сессия     │     │   контейнер   │
└───────────────┘     └───────────────┘     └───────────────┘
```

## Зависимости

Библиотека использует минимальный набор зависимостей:
- Нет production зависимостей
- ESLint для разработки
