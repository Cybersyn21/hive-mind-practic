# Каталог src/ — Исходный код агента

## Описание

Каталог `src/` содержит весь исходный код AI-агента. Код написан на TypeScript и выполняется напрямую через Bun без предварительной компиляции.

## Структура каталога

| Папка/Файл | Описание |
|------------|----------|
| `agent/` | Основная логика AI-агента и генерация ответов |
| `auth/` | Система аутентификации |
| `bun/` | Bun-специфичный код и интеграции |
| `bus/` | Глобальная шина событий для коммуникации между компонентами |
| `cli/` | Интерфейс командной строки и парсинг аргументов |
| `command/` | Обработка и выполнение команд |
| `config/` | Конфигурация приложения и парсинг markdown |
| `file/` | Работа с файловой системой (ripgrep, watcher) |
| `flag/` | Обработка флагов командной строки |
| `format/` | Форматирование вывода (JSON, текст) |
| `global/` | Глобальные переменные и состояние |
| `id/` | Генерация уникальных идентификаторов (ULID) |
| `json-standard/` | Стандарты JSON вывода (OpenCode, Claude) |
| `mcp/` | Model Context Protocol — интеграция с MCP серверами |
| `patch/` | Патчи и временные исправления |
| `project/` | Управление проектами и рабочими директориями |
| `provider/` | Провайдеры AI моделей (OpenCode, xAI и др.) |
| `server/` | Внутренний HTTP сервер для сессий |
| `session/` | Управление сессиями, промптами, сообщениями |
| `snapshot/` | Снимки состояния системы |
| `storage/` | Постоянное хранилище данных |
| `tool/` | 13 инструментов агента (bash, read, write и др.) |
| `util/` | Вспомогательные утилиты |
| `index.js` | Главная точка входа приложения |
| `file.ts` | Базовые операции с файлами |

## Архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                      CLI (cli/cmd/)                          │
│  Парсинг аргументов, запуск команд (agent, run, mcp и др.) │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     Session (session/)                       │
│  Управление сессией, история сообщений, системные промпты   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      Agent (agent/)                          │
│  Основная логика: обработка запросов, вызов инструментов   │
└─────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    ▼                   ▼
┌─────────────────────────┐  ┌─────────────────────────┐
│    Provider (provider/) │  │      Tool (tool/)        │
│  Отправка запросов к AI │  │  Выполнение инструментов │
│  моделям (Grok, GPT..)  │  │  (bash, read, write...)  │
└─────────────────────────┘  └─────────────────────────┘
```

## Поток данных

1. **Вход**: JSON или текст через stdin
2. **CLI**: Парсинг аргументов и инициализация
3. **Session**: Создание сессии с уникальным ID
4. **Agent**: Отправка запроса к AI модели
5. **Provider**: Коммуникация с API модели
6. **Tools**: Выполнение инструментов по запросу AI
7. **Выход**: Потоковый JSON с событиями

## Основные файлы

### index.js
Главная точка входа. Читает stdin, инициализирует агента, выводит результаты.

### file.ts
Базовые операции с файловой системой, используемые другими модулями.
