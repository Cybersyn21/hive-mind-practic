# Каталог util/ — Вспомогательные утилиты

## Описание

Каталог `util/` содержит набор вспомогательных функций и утилит, используемых по всему проекту.

## Файлы

### binary.ts
**Назначение**: Работа с бинарными данными.
- Кодирование/декодирование
- Работа с буферами
- Преобразование форматов

### context.ts
**Назначение**: Управление контекстом выполнения.
- Хранение глобального состояния
- Передача контекста между функциями
- Изоляция контекстов

### defer.ts
**Назначение**: Отложенные промисы.
- Создание deferred промисов
- Ручное разрешение/отклонение
- Синхронизация асинхронных операций

### error.ts
**Назначение**: Обработка ошибок.
- Кастомные типы ошибок
- Форматирование стек-трейсов
- Логирование ошибок

### eventloop.ts
**Назначение**: Работа с event loop.
- Управление микро/макрозадачами
- Отложенное выполнение
- Синхронизация с event loop

### filesystem.ts
**Назначение**: Работа с файловой системой.
- Чтение/запись файлов
- Создание директорий
- Проверка существования

### fn.ts
**Назначение**: Функциональные утилиты.
- Композиция функций
- Каррирование
- Мемоизация

### iife.ts
**Назначение**: Immediately Invoked Function Expressions.
- Обёртки для IIFE
- Изоляция области видимости

### keybind.ts
**Назначение**: Обработка клавиатурных сочетаний.
- Парсинг комбинаций клавиш
- Биндинги для CLI

### lazy.ts
**Назначение**: Ленивые вычисления.
- Отложенная инициализация
- Кеширование значений
- Lazy loading

### locale.ts
**Назначение**: Локализация.
- Определение языка системы
- Форматирование дат/чисел
- Локализованные сообщения

### lock.ts
**Назначение**: Блокировки и синхронизация.
- Мьютексы
- Семафоры
- Предотвращение race conditions

### log.ts
**Назначение**: Логирование.
- Уровни логирования (debug, info, warn, error)
- Форматирование логов
- Вывод в файл/консоль

### queue.ts
**Назначение**: Очереди задач.
- Асинхронные очереди
- Приоритетные очереди
- Ограничение параллельности

### rpc.ts
**Назначение**: Remote Procedure Call.
- Сериализация вызовов
- Транспорт сообщений
- Обработка ответов

### scrap.ts
**Назначение**: Утилиты для парсинга.
- Извлечение данных
- Обработка текста
- Парсинг структур

### signal.ts
**Назначение**: Сигналы и реактивность.
- Создание сигналов
- Подписка на изменения
- Реактивные вычисления

### timeout.ts
**Назначение**: Таймауты.
- Создание таймаутов
- Отмена таймаутов
- Промисы с таймаутом

### token.ts
**Назначение**: Работа с токенами.
- Подсчёт токенов
- Оценка стоимости
- Оптимизация контекста

### wildcard.ts
**Назначение**: Работа с шаблонами.
- Glob-паттерны
- Wildcard matching
- Фильтрация файлов

## Примеры использования

### Отложенный промис (defer.ts)
```typescript
import { defer } from './defer';

const { promise, resolve, reject } = defer<string>();

// Где-то позже...
resolve('Готово!');

await promise; // 'Готово!'
```

### Логирование (log.ts)
```typescript
import { log } from './log';

log.debug('Отладочная информация');
log.info('Информационное сообщение');
log.warn('Предупреждение');
log.error('Ошибка');
```

### Ленивые вычисления (lazy.ts)
```typescript
import { lazy } from './lazy';

const expensiveValue = lazy(() => {
  console.log('Вычисляю...');
  return computeExpensiveValue();
});

// Вычисление произойдёт только при первом обращении
console.log(expensiveValue.get());
```

### Очередь задач (queue.ts)
```typescript
import { Queue } from './queue';

const queue = new Queue({ concurrency: 3 });

queue.add(async () => {
  await processItem(1);
});

queue.add(async () => {
  await processItem(2);
});

await queue.drain();
```

## Архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                    Основной код агента                       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                         util/                                │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │   log.ts    │ │   defer.ts  │ │  timeout.ts │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │   queue.ts  │ │   lazy.ts   │ │   lock.ts   │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
│                        ...                                   │
└─────────────────────────────────────────────────────────────┘
```
