# Каталог provider/ — Провайдеры AI-моделей

## Описание

Каталог `provider/` содержит реализацию взаимодействия с различными AI-моделями через их API. Поддерживаются модели OpenCode Zen, xAI (Grok) и другие.

## Файлы

### provider.ts
**Назначение**: Базовый интерфейс провайдера.
- Определение типов и интерфейсов
- Абстракция для всех провайдеров
- Унифицированный API вызова моделей

### models.ts
**Назначение**: Список поддерживаемых моделей.
- Конфигурация каждой модели
- Параметры (контекст, токены, цена)
- Маппинг ID моделей

### models-macro.ts
**Назначение**: Макросы для моделей.
- Алиасы моделей (например, `sonnet` → полный ID)
- Группировка моделей по провайдерам

### opencode.js
**Назначение**: Провайдер OpenCode.
- Интеграция с OpenCode Zen API
- Поддержка бесплатных моделей (Grok Code Fast 1)
- Форматирование запросов и ответов

### transform.ts
**Назначение**: Трансформация данных.
- Преобразование форматов между провайдерами
- Нормализация ответов
- Обработка потоковых данных

## Поддерживаемые модели

### Бесплатные (OpenCode Zen)

| Модель | ID | Описание |
|--------|-----|----------|
| Grok Code Fast 1 | `opencode/grok-code` | По умолчанию, быстрая |
| Big Pickle | `opencode/big-pickle` | Альтернативная |
| GPT-5 Nano | `opencode/gpt-5-nano` | Компактная |

### Премиум (OpenCode Zen подписка)

| Модель | ID | Описание |
|--------|-----|----------|
| Claude Sonnet 4.5 | `opencode/sonnet` | Сбалансированная |
| Claude Haiku 4.5 | `opencode/haiku` | Быстрая |
| Claude Opus 4.1 | `opencode/opus` | Мощная |
| Gemini 3 Pro | `opencode/gemini-3-pro` | Google |

## Архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                         Agent                                │
│              (Запрос на генерацию ответа)                   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     provider.ts                              │
│                (Выбор провайдера по ID модели)              │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ▼                     ▼                     ▼
┌───────────────┐     ┌───────────────┐     ┌───────────────┐
│   opencode.js │     │   (xai.ts)    │     │  (другие...)  │
│  OpenCode Zen │     │   xAI Grok    │     │               │
└───────────────┘     └───────────────┘     └───────────────┘
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      transform.ts                            │
│              (Нормализация ответа в единый формат)          │
└─────────────────────────────────────────────────────────────┘
```

## Потоковые ответы

Все провайдеры поддерживают потоковую передачу данных (streaming):

```typescript
for await (const chunk of provider.stream(request)) {
  if (chunk.type === 'text') {
    console.log(chunk.text);
  } else if (chunk.type === 'tool_use') {
    await executeTool(chunk.tool);
  }
}
```

## Пример использования

```typescript
import { getProvider } from './provider';

const provider = getProvider('opencode/grok-code');

const response = await provider.generate({
  messages: [
    { role: 'system', content: 'Ты ассистент' },
    { role: 'user', content: 'Привет!' }
  ]
});
```

## Добавление нового провайдера

1. Создайте файл `newprovider.ts`
2. Реализуйте интерфейс `Provider`
3. Добавьте модели в `models.ts`
4. Зарегистрируйте провайдер в `provider.ts`
