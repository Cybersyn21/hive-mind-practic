# Каталог cli/ — Интерфейс командной строки

## Описание

Каталог `cli/` содержит реализацию интерфейса командной строки (CLI) агента. Здесь определены все команды, парсинг аргументов и обработка ввода/вывода.

## Файлы

### bootstrap.ts / bootstrap.js
**Назначение**: Инициализация CLI.
- Настройка окружения
- Загрузка конфигурации
- Подготовка к запуску команд

### error.ts
**Назначение**: Обработка ошибок CLI.
- Форматирование сообщений об ошибках
- Коды выхода
- Логирование ошибок

### ui.ts
**Назначение**: Элементы пользовательского интерфейса.
- Форматирование вывода
- Цветовое оформление (для терминала)
- Индикаторы прогресса

## Каталог cmd/

Содержит реализацию отдельных команд CLI.

| Файл | Команда | Описание |
|------|---------|----------|
| `agent.ts` | `agent` | Основная команда запуска агента |
| `cmd.ts` | — | Базовый класс для команд |
| `export.ts` | `export` | Экспорт сессий и данных |
| `mcp.ts` | `mcp` | Управление MCP серверами |
| `models.ts` | `models` | Список доступных моделей |
| `run.ts` | `run` | Запуск агента в режиме run |
| `stats.ts` | `stats` | Статистика использования |

## Опции командной строки

```bash
agent [options]

Опции:
  --model                        Модель (providerID/modelID)
                                 По умолчанию: opencode/grok-code

  --json-standard                Стандарт JSON вывода
                                 Варианты: "opencode" (по умолчанию), "claude"

  --system-message               Полная замена системного промпта

  --system-message-file          Загрузка системного промпта из файла

  --append-system-message        Добавление к системному промпту

  --append-system-message-file   Добавление к системному промпту из файла

  --help                         Показать справку

  --version                      Показать версию
```

## Архитектура CLI

```
┌─────────────────────────────────────────────────────────────┐
│                      Пользователь                            │
│              (agent --model opencode/grok-code)             │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     bootstrap.ts                             │
│  • Парсинг аргументов (yargs)                               │
│  • Валидация опций                                          │
│  • Загрузка конфигурации                                    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                       cmd/agent.ts                           │
│  • Определение команды agent                                 │
│  • Обработка опций                                          │
│  • Запуск агента                                            │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                         Agent                                │
│              (Основная логика обработки)                    │
└─────────────────────────────────────────────────────────────┘
```

## Потоки ввода/вывода

### Ввод (stdin)
- Принимает JSON или простой текст
- Простой текст автоматически конвертируется в JSON

### Вывод (stdout)
- Потоковый JSON (события в реальном времени)
- Форматы: OpenCode (по умолчанию) или Claude

### Ошибки (stderr)
- Сообщения об ошибках
- Диагностическая информация

## Примеры использования

```bash
# Простой запрос
echo "Привет" | agent

# С JSON
echo '{"message":"Привет"}' | agent

# С выбором модели
echo "Привет" | agent --model opencode/sonnet

# С кастомным системным промптом
echo "Объясни" | agent --system-message "Ты учитель математики"

# Загрузка промпта из файла
echo "Вопрос" | agent --system-message-file prompt.txt

# Вывод в формате Claude
echo "Привет" | agent --json-standard claude
```

## Обработка ошибок

```typescript
try {
  await runAgent(options);
} catch (error) {
  if (error instanceof ValidationError) {
    console.error('Ошибка валидации:', error.message);
    process.exit(1);
  }
  throw error;
}
```
